{% extends 'base.html' %}
{% block content %}
<h1>All Games</h1>

<h2>Active Games</h2>
{% if active_games %}
<ul>
  {% for game in active_games %}
    <li>
      <a href="{{ url_for('game_detail', game_id=game.id) }}">{{ game.name }}</a>
      <form action="{{ url_for('settle_game', game_id=game.id) }}" method="post" style="display:inline;">
        <button type="submit">Mark as Settled</button>
      </form>
      <ul>
        <li><strong>Buy-ins:</strong>
          <ul>
            {% for buyin in game.buyins %}
              <li>
                {{ buyin.player.name }}: £{{ "%.2f"|format(buyin.amount) }}
              </li>
            {% endfor %}
          </ul>
        </li>

        <li><strong>Winners:</strong>
          <ul>
            {% if game.winners %}
              {% for winner in game.winners %}
                <li>{{ winner.name }}: {{ winner.percentage }}%</li>
              {% endfor %}
            {% else %}
              <li>No winners assigned yet</li>
            {% endif %}
          </ul>
        </li>
      </ul>
    </li>
  {% endfor %}
</ul>
{% else %}
<p>No active games</p>
{% endif %}

<hr>

<h2>Settled Games</h2>
{% if settled_games %}
<ul>
  {% for game in settled_games %}
    <li>
      <a href="{{ url_for('game_detail', game_id=game.id) }}">{{ game.name }}</a>
      <form action="{{ url_for('reactivate_game', game_id=game.id) }}" method="post" style="display:inline;">
        <button type="submit">Reactivate Game</button>
      </form>
      <ul>
        <li><strong>Buy-ins:</strong>
          <ul>
            {% for buyin in game.buyins %}
              <li>
                {{ buyin.player.name }}: £{{ "%.2f"|format(buyin.amount) }}
              </li>
            {% endfor %}
          </ul>
        </li>

        <li><strong>Winners:</strong>
          <ul>
            {% if game.winners %}
              {% for winner in game.winners %}
                <li>{{ winner.name }}: {{ winner.percentage }}%</li>
              {% endfor %}
            {% else %}
              <li>No winners assigned yet</li>
            {% endif %}
          </ul>
        </li>
      </ul>
    </li>
  {% endfor %}
</ul>
{% else %}
<p>No active games</p>
{% endif %}

<!-- <h2>Settled Games</h2>
{% if settled_games %}
<ul>
  {% for game in settled_games %}
    <li>
      <a href="{{ url_for('game_detail', game_id=game.id) }}">{{ game.name }}</a>
      <form action="{{ url_for('reactivate_game', game_id=game.id) }}" method="post" style="display:inline;">
        <button type="submit">Reactivate Game</button>
      </form>
      <ul>
        <li><strong>Players:</strong> {{ game.players | join(', ') }}</li>
        <li><strong>Buy-ins:</strong>
          <ul>
            {% for b in game.buyins %}
              <li>{{ b.player }}: £{{ "%.2f"|format(b.amount) }}</li>
            {% endfor %}
          </ul>
        </li>
        <li><strong>Winners:</strong>
          <ul>
            {% if game.winnings %}
              {% for player, percent in game.winnings.items() %}
                <li>{{ player }}: {{ percent }}%</li>
              {% endfor %}
            {% else %}
              <li>No winners assigned yet</li>
            {% endif %}
          </ul>
        </li>
      </ul>
    </li>
  {% endfor %}
</ul>
{% else %}
<p>No settled games</p>
{% endif %}

<p><a href="{{ url_for('home') }}">Back to Home</a></p>
<p><a href="{{ url_for('debts_summary') }}">View Simplified Debts</a></p>
{% endblock %} -->
